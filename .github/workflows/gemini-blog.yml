# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“ã«ãƒªãƒã‚¸ãƒˆãƒªã¸ã®æ›¸ãè¾¼ã¿æ¨©é™ã‚’ä»˜ä¸
permissions:
  contents: write

name: Daily Funwari Forecast Blog

on:
  schedule:
    - cron: '0,30 22-23,0-16 * * *'  # JST 07:00ã€œ01:00 ã«30åˆ†ã”ã¨ã«å®Ÿè¡Œ
  workflow_dispatch:

jobs:
  generate-forecast:
    runs-on: ubuntu-latest

    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

    steps:
      - name: ğŸ“¥ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: ğŸ›  Node.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ğŸ“¦ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: npm install axios

      - name: âœ¨ Gemini APIã§ãµã‚“ã‚ã‚Šäºˆå ±ã‚’ç”Ÿæˆã—Markdownã«ä¿å­˜
        run: node .github/scripts/generate-quote.js

      - name: âœ… Gitã¸ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add _posts/*-funwari-forecast.md
          if ! git diff --cached --quiet; then
            git commit -m "ğŸ”® ç¾åœ¨ã®ãµã‚“ã‚ã‚Šäºˆå ±ã‚’è‡ªå‹•æŠ•ç¨¿ (`date --iso-8601=seconds`)"
            git push
          else
            echo "å¤‰æ›´ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"
